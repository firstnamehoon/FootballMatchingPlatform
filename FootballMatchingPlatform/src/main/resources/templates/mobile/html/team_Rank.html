<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="stylesheet" href="mobile/css/common.css" />
  <link rel="stylesheet" href="mobile/css/team.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

</head>

<body>
  <!-- 모바일 컨테이너 -->
  <div id="mobile-container">
    <!-- 헤더 -->
	
    <header></header>
    <!-- 컨텐츠 컨테이너 -->
    <div id="container">

      <div class="d-flex gap-2 justify-content-between p-2 pt-2 m-2 mb-0">
        <div class="btnBox" id="allTeamRank">
          <button type="button" class="selectBtn p-2 btnClick" >전체 팀 순위</button>
        </div>
        <div class="btnBox" id="possJoin">
          <button type="button" class="selectBtn p-2" >가입 가능 팀</button>
        </div>
        <div class="btnBox" id="joinList">
          <button type="button" class="selectBtn p-2" >가입 신청 목록</button>
        </div>
        <div class="btnBox" id="myTeamInfo">
          <button type="button" class="selectBtn p-2" >내 팀 정보</button>
        </div>
      </div>

      <div class="d-flex justify-content-center m-2">
        <div id="row">
          <input id="search-keyword" placeholder="검색어를 입력하세요">
          <img id="search" src="../img/search.svg">
        </div>
      </div>

      <div class="d-flex flex-column gap-2 w-100 p-2" id="dataBox">


      </div>

    </div>
    <!-- 하단 메뉴바 -->
    <nav></nav>
  </div>

  <script>
    // header, nav 내용 불러오기
    $(document).ready(function () {
      $("header").load("./common/header_back.html", function () {
        // 뒤로가기 필요한 페이지는 header_back, 아닌 페이지는 header 사용해주세욤
        $("#page-name").text("팀"); // 해당 페이지 이름 넣어주세욤 ex) 마이페이지
        $("#user-tier").text("B"); // 나중에 세션에서 usertier 구해서 넣기
      });
      $("nav").load("./common/nav.html");
      
      //팀 유무 판단
      isTeam("user010");
      
      
      allTeamRank();
      
      $('#allTeamRank').on('click', function(){
            $(".selectBtn").removeClass('btnClick');
			$("#allTeamRank > button").addClass('btnClick');
      		allTeamRank();
      })
      
      $('#possJoin').on('click', function(){
      		$(".selectBtn").removeClass('btnClick');
			$("#possJoin > button").addClass('btnClick');
    	
      		possJoinTeam();
      })
      
    });

    function isTeam(userId){
    	fetch("/team/isTeam/"+userId)
	   	.then(response =>response.json())
	   	.then(data =>{
	   		var userId = data.result;
	   		console.log(userId)
	   		if(data.result === " "){
				$("#myTeamInfo").hide();
	   		}
	   		else{
	   			$("#possJoin").hide();
     	 		$("#joinList").hide();
	   		}

	   	 })
    }
    
    
    // 전체 팀 순위
    function allTeamRank(){
    	fetch("/team/rank")
	   	.then(response =>response.json())
	   	.then(data =>{   	   	 
	   		let res = data.result;
	   	   	let str ="";
	   	   	for(var i in res){
	   	   		str += `<div class="content-container border border-2 rounded-4">
          				<div class="first-content-container">
            			<div class="ranking">`+res[i].teamRank+`</div>
            			<div class="name">
             				<span class="teamname">`+res[i].teamName+`</span>
            			</div>
         				</div>
          				<div class="second-content-container">
			            <div class="gameCount">`+res[i].gameCount+`</div>
			            <div class="odds">`+res[i].odds+`</div>
			            <div class="tier">`+res[i].teamTier+`</div>
			            <div class="score">`+res[i].teamScore+`</div>
          				</div>
        				</div>`;
	   	   	 }
	   	   	 $('#dataBox').html(str);

	   	 })
    }
    
    function joinBtnClick(){
        $(".joinBtn").on('click', function(){
      		$(".joinBtn").removeClass('btnClick');
     		$(this).addClass('btnClick');
     		alert("가입신청");
    	})
    }
    
    //가입 가능팀 조회
    function possJoinTeam(){
	    fetch("/team/possJoin")
				.then(response =>response.json())
		   	 	.then(data =>{   	   	 
		   	   		let res = data.result;
		   	   		let str ="";
		   	   		
		   	   	 	for(var i in res){
		   	   	 		str +=         		 
						`<div class="content-container border border-2 rounded-4 p-3">
	          				<div class="teamInfo col-9 d-flex align-items-center content-text p-0">
	            				<div class="d-flex">
	              					<div class="content-title pe-2">`+res[i].teamName+`</div>
	              					<div class="content-tier ps-1">`;
	              			
	              		if(res[i].possA == false && res[i].possB == false &&
	              				res[i].possC == false && res[i].possD == false){
	              				str += '<span class="badge rounded-5">남녀무관</span>';
	              			}
	              			else{
	              				if(res[i].possA == true)
	              					str += '<span class="badge rounded-5">A</span>';
	              				if(res[i].possB == true)
	              					str += '<span class="badge rounded-5">B</span>';
	              				if(res[i].possC == true)
	              					str += '<span class="badge rounded-5">C</span>';
	              				if(res[i].possD == true)
	              					str += '<span class="badge rounded-5">D</span>';
	              			}
	             			str += `</div>
	            		</div>
			            <div class="content-info">`+ res[i].weekType + `/` +
			            res[i].weekTime + `/` +  res[i].hopeTime+ `/` + res[i].hometown +`</div>
			            <div class="content-member p-0">` + res[i].memberCount + `/10명</div>
	         		</div>
	         		<div class="col d-flex justify-content-end p-0">
	            		<button class="joinBtn rounded-5 p-2">가입신청</button>
	          		</div>
	       		</div>`;
		   	   	 	
		   	   	 	}
		   	   	 $('#dataBox').html(str);
		   	   	 
		   	   	 joinBtnClick();
	
		   	 })
    }

    $("#searchTeamButton").on("click", function () {
      alert("팀 검색");
    });


  </script>
</body>

</html>